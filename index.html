<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>KssS Restaurant QR POS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
header{background:#000;padding:12px;text-align:center}
h2{margin:0;color:#ffd700}
.tableBox{text-align:center;margin-top:6px;font-size:16px}

.category{background:#d32f2f;padding:8px;margin-top:15px;text-align:center;font-weight:bold}
.item{border-bottom:1px solid #333;padding:8px}
.top{display:flex;justify-content:space-between;margin-bottom:6px}

.plate button{padding:4px 6px;margin-right:5px;border:none;border-radius:4px;background:#555;color:#fff;font-size:13px}
.plate button.active{background:#388e3c}

.qty{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
.qty button{padding:4px 8px;background:#ff9800;border:none;color:#000;border-radius:4px;font-weight:bold}
.qty span{min-width:22px;text-align:center}

.pack{font-size:14px}
.total{font-size:22px;text-align:center;margin:15px;color:#0f0}

.place{width:90%;margin:auto;display:block;font-size:18px;padding:10px;background:#d32f2f;color:#fff;border:none;border-radius:6px}

.container{max-width:520px;margin:auto}
footer{text-align:center;font-size:14px;padding:8px;background:#000}
</style>
</head>

<body>

<header>
<h2>KssS Restaurant â€“ 100% Veg</h2>
</header>

<div class="tableBox">
Table No: <b id="tableNo">N/A</b>
</div>

<div class="container">
<div id="menu"></div>

<div class="total">Total â‚¹ <span id="total">0</span></div>
<button class="place" onclick="placeOrder()">Place Order</button>
</div>

<footer>QR POS System</footer>

<script>
/* ---------- TABLE LOGIC (FIXED) ---------- */
const params = new URLSearchParams(window.location.search);
let tableParam = params.get("table");
let tableNo = "N/A";

if(tableParam !== null){
  let t = parseInt(tableParam,10);
  if(!isNaN(t) && t>=1 && t<=8){
    tableNo = t;
  }
}
document.getElementById("tableNo").innerText = tableNo;

/* ---------- MENU ---------- */
let menuData=[
{category:"ðŸ¥¢ Chinese",items:[
{name:"Veg Chowmein",price:60},
{name:"Paneer Chowmein",price:80},
{name:"Veg Steam Momos",price:80},
{name:"Paneer Steam Momos",price:100}
]},
{category:"ðŸ• Pizza",items:[
{name:"Cheese Pizza",price:120},
{name:"Paneer Pizza",price:180}
]},
{category:"ðŸ” Snacks",items:[
{name:"Veg Burger",price:30},
{name:"Paneer Burger",price:40},
{name:"French Fries",price:50}
]}
];

let cart={},total=0;
const menuDiv=document.getElementById("menu");
const totalSpan=document.getElementById("total");

/* ---------- LOAD MENU ---------- */
function loadMenu(){
menuDiv.innerHTML="";
cart={};
menuData.forEach(cat=>{
menuDiv.innerHTML+=`<div class="category">${cat.category}</div>`;
cat.items.forEach(i=>{
let id=i.name.replace(/\s/g,"");
cart[id]={name:i.name,price:i.price,qty:0,pack:false};

menuDiv.innerHTML+=`
<div class="item">
<div class="top"><b>${i.name}</b><span>â‚¹${i.price}</span></div>

<div class="plate">
<button class="active" onclick="setPlate('${id}',${i.price},this)">Full</button>
<button onclick="setPlate('${id}',${i.price*0.6},this)">Half</button>
</div>

<div class="qty">
<div>
<button onclick="qty('${id}',-1)">âˆ’</button>
<span id="q_${id}">0</span>
<button onclick="qty('${id}',1)">+</button>
</div>
<label class="pack">
<input type="checkbox" onchange="setPack('${id}',this)"> ðŸ“¦ Pack
</label>
</div>
</div>`;
});
});
}

/* ---------- CART ---------- */
function setPlate(id,price,btn){
cart[id].price=Math.round(price);
btn.parentElement.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
calc();
}
function qty(id,d){
cart[id].qty+=d;
if(cart[id].qty<0)cart[id].qty=0;
document.getElementById("q_"+id).innerText=cart[id].qty;
calc();
}
function setPack(id,c){cart[id].pack=c.checked}
function calc(){
total=0;
Object.values(cart).forEach(i=>total+=i.price*i.qty);
totalSpan.innerText=total;
}

/* ---------- PLACE ORDER (BILL FIXED) ---------- */
function placeOrder(){
if(total===0){alert("No items selected");return;}

let now=new Date();
let dateTime=now.toLocaleDateString()+" "+now.toLocaleTimeString();

let items=Object.values(cart).filter(i=>i.qty>0);

let billHTML=`
<h3 style="text-align:center">KssS Restaurant</h3>
<p style="text-align:center">100% Veg</p>
<hr>
<b>Date:</b> ${dateTime}<br>
<b>Table:</b> ${tableNo}
<hr>
${items.map(i=>`
<p>${i.pack?"ðŸ“¦ ":""}${i.name} â€” â‚¹${i.price} Ã— ${i.qty} = â‚¹${i.price*i.qty}</p>
`).join("")}
<hr>
<b>TOTAL: â‚¹${total}</b>
`;

let w=window.open("","_blank");
w.document.write(`
<html>
<head>
<title>Bill</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Arial;padding:10px}
button{width:100%;padding:12px;font-size:18px;margin-top:20px}
</style>
</head>
<body>
${billHTML}
<button onclick="window.print()">PRINT</button>
</body>
</html>
`);
w.document.close();

loadMenu();total=0;totalSpan.innerText=0;
}

loadMenu();
</script>

</body>
</html>
